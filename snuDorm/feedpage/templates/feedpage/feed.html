{% extends 'base.html' %}
{% block content %}

{% if user.is_authenticated %}
<div class="info">
    <div>{{ board_name }} </div>
    {% if feed.author == request.user %}
    <div style="margin: 10px; text-align: right;">
        <a href="{% url 'editfeed' board category feed.id %}">수정</a>
        <a href="{% url 'deletefeed' board category feed.id %}">삭제</a>
    </div>
    {% else %}
    {% if not feed.noname %}
        <div style="margin: 10px; text-align: right;">
            <a href="{% url 'chatroom' request.user.id feed.author.id  %}">
                쪽지보내기
            </a>
        </div>
    {% endif %}
    {% endif %}
    <div style="display:flex; justify-content:space-around;">
        <div style="display:flex"> 
            <div>작성자</div>
            <div class="feed_author_name">
                {% if feed.noname %} 
                    <div>익명</div>
                {% else %}
                    {{ feed.author.profile.nickname }}
                {% endif %}
            </div> 
        </div> 
        <div style="display:flex; align-items: right;">
            <div> {{ feed.status.1 }} </div>
            <div>
                <a class='feed-like' data-board="{{ board }}" data-category="{{ category }}" data-fid='{{ feed.id }}' data-count='{{ feed.feedlike.count }}' data-csrfmiddlewaretoken="{{ csrf_token }}">{{ feed.like_users.count }} 좋아요</a>
            </div>
            <div class="feed_comment_count">
                {{ feed.feedcomment_set.count }} 댓글 수 
            </div> 
            <div class="feed_created_date">
                {{ feed.created_at|date:"y.m.d"}}
            </div>
        </div> 
    </div> 
    {% if board == "minwon" or board == 'freeboard' %}
        <div>
            {{ feed.title }} </br>
            {{ feed.content }} </br>
            {% for photo in feed.image_set.all %} 
                <img src="{{ photo.photo.url }}" alt="" width:"200px" height="200px">
            {% endfor %} <br/>
        </div>
    {% elif board == "life" %}
        {% if category == "cobuy" %}
            <div>
                {{ feed.title }} </br>
                링크  <a href="https://{{ feed.url }}"> {{ feed.url }}</a> </br>
                {% if feed.duedate|date:"Y.m.d" == '2020.01.01' %}
                    마감일 미정</br>
                {% else %}
                    마감일 {{ feed.duedate|date:"Y.m.d" }} </br>
                {% endif %}
                {{ feed.content }} </br>
                {% if feed.photo %} 
                    <img src="{{ feed.photo.url }}" alt="" width:"30%" height="20%">
                {% endif %} <br/>
            </div>
        {% elif category == "rent" %}
            <div>
                {{ feed.title }} </br>
                목적 {{ feed.purpose.1 }} </br>
                대여료 {{ feed.deposit }} </br>
                 {% if feed.start_date|date:"Y.m.d" == '2020.01.01' %}
                    시작일 미정 </br>
                {% else %}
                    시작일 {{ feed.start_date|date:"Y.m.d" }} </br>
                {% endif %}
                {% if feed.end_date|date:"Y.m.d" == '2020.01.01' %}
                    마감일 미정</br>
                {% else %}
                    마감일 {{ feed.end_date|date:"Y.m.d" }} </br>
                {% endif %}
                {{ feed.content }} </br>
                {% if feed.photo %} 
                    <img src="{{ feed.photo.url }}" alt="" width:"30%" height="20%">
                {% endif %} <br/>     
            </div>
        {% elif category == "keep" %}
            <div>
                {{ feed.title }} </br>
                목적 {{ feed.purpose.1 }} </br>
                보관료 {{ feed.reward }} </br>
                {% if feed.start_date|date:"Y.m.d" == '2020.01.01' %}
                    시작일 미정 </br>
                {% else %}
                    시작일 {{ feed.start_date|date:"Y.m.d" }} </br>
                {% endif %}
                {% if feed.end_date|date:"Y.m.d" == '2020.01.01' %}
                    마감일 미정</br>
                {% else %}
                    마감일 {{ feed.end_date|date:"Y.m.d" }} </br>
                {% endif %}
                {{ endif }}
                {{ feed.content }} </br>
                {% if feed.photo %} 
                    <img src="{{ feed.photo.url }}" alt="" width:"30%" height="20%">
                {% endif %} <br/>
            </div>  
        {% elif category == "resell" %}
            <div>
                {{ feed.title }} </br>
                목적 {{ feed.purpose.1 }} </br>
                가격 {{ feed.price }} </br>
                {{ feed.content }} </br>
                {% if feed.photo %} 
                    <img src="{{ feed.photo.url }}" alt="" width:"30%" height="20%">
                {% endif %} <br/>
            </div>
        {% endif %}
    {% endif %}

</div>


{% for c in feed.feedcomment_set.all %}
<div>
    <div>
        {% if c.noname %} 
        <p>익명
        {% else %}
        <p>{{ c.author.profile.nickname }}
        {% endif %}
        : {{ c.content }}</p>
        {% if request.user == c.author %}
        <a class='editcommentform'>
            <button>수정</button>
        </a>
        <form method="POST" class='deletecomment' data-board="{{ board }}" data-category="{{ category }}" data-fid='{{ feed.id }}' data-cid='{{ c.id }}' data-csrfmiddlewaretoken="{{ csrf_token }}">
            {% csrf_token %}
            <button>삭제</button>
        </form>
        {% endif %}
        {% if user.is_authenticated %}
        <div>
            <a class='comment-like' data-board="{{ board }}" data-category="{{ category }}" data-fid='{{ feed.id }}' data-cid='{{ c.id }}' data-count='{{ c.commentlike_set.count }}' data-csrfmiddlewaretoken="{{ csrf_token }}">댓글 좋아요: [{{ c.commentlike_set.count }}]</a>
        </div>
        {% endif %}
    </div>
    <div id='editcommentsubmit' style="display: none">
        <form method="POST" class="comment-edit"
        data-board="{{ board }}" data-category="{{ category }}" data-fid="{{ feed.id }}" data-cid="{{c.id}}" data-count = "{{ c.commentlike_set.count }}"
        data-csrfmiddlewaretoken="{{ csrf_token }}">
        {% csrf_token %}
        <input id="{{ feed.id }}_{{ c.id }}" type="text" name="content" value="{{ c.content }}"/>
        <button type="submit">댓글 수정</button>
        </form>
    </div>
    {% for d in c.recomment_set.all %}
    <div>
        <div>
            {% if d.noname %} 
            <p>익명
            {% else %}
            <p>{{ d.author.profile.nickname }}
            {% endif %}
            : {{ d.content }}</p>
            {% if request.user == d.author %}
            <a class='editrecommentform'>
                <button>대댓글 수정</button>
            </a>
            <form method="POST" class='deleterecomment' data-board="{{ board }}" data-category="{{ category }}" data-fid='{{ feed.id }}' data-cid='{{ c.id }}' data-did='{{ d.id }}' data-csrfmiddlewaretoken="{{ csrf_token }}">
                {% csrf_token %}
                <button>대댓글 삭제</button>
            </form>
            {% endif %}
            {% if user.is_authenticated %}
            <div>
                <a class='recomment-like' data-board="{{ board }}" data-category="{{ category }}" data-fid='{{ feed.id }}' data-cid='{{ c.id }}' data-did='{{ d.id }}' data-count='{{ d.recommentlike_set.count }}' data-csrfmiddlewaretoken="{{ csrf_token }}">대댓글 좋아요: [{{ d.recommentlike_set.count }}]</a>
            </div>
            {% endif %}
        </div>
        <div id='editrecommentsubmit' style="display: none">
            <form method="POST" class="recomment-edit"
            data-board="{{ board }}" data-category="{{ category }}" data-fid="{{ feed.id }}" data-cid="{{c.id}}" data-did="{{ d.id }}" data-count = "{{ d.recommentlike_set.count }}"
            data-csrfmiddlewaretoken="{{ csrf_token }}">
            {% csrf_token %}
            <input id="c{{ c.id }}_d{{ d.id }}" type="text" name="content" value="{{ d.content }}"/>
            <button type="submit">대댓글 수정</button>
            </form>
        </div>
    </div>
    {% endfor %}
    <div>
    {% if user.is_authenticated %}
    <form method="POST" class="recomment-submit" data-board="{{ board }}" data-category="{{ category }}" data-fid="{{ feed.id }}" data-cid="{{ c.id }}"data-csrfmiddlewaretoken="{{ csrf_token }}">
        {% csrf_token %}
        <input id ="c{{ c.id }}" type="text" name="content" />
        <button type="submit">대댓글 달기</button>
        <input name="noname" type="checkbox" id="nonamec{{ c.id }}">
        <label for="nonamec{{ c.id }}">익명</label>
    </form>
    {% endif %}
    </div>
</div>

{% endfor %}
    <form method="POST" class="comment-submit"
        data-board="{{ board }}" data-category="{{ category }}" data-fid="{{ feed.id }}"
        data-csrfmiddlewaretoken="{{ csrf_token }}">
        {% csrf_token %}
        <input id="{{ feed.id }}" type="text" name="content" />
        <button type="submit">댓글 달기</button>
        <input name="noname" type="checkbox" id="noname{{ feed.id }}">
        <label for="noname{{ feed.id }}">익명</label>  
    </form>
{% else %}


<div>
    <h1>로그인 후 이용해 주세요!</h1>
    <a href="{% url 'login' %}">로그인</a>
</div>

{% endif %}
{% endblock content %}