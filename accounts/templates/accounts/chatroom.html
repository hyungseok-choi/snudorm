{% extends 'base.html' %}
{% block content %}
{% load static %}

<head><link rel="stylesheet" href="{% static 'accounts/css/chat.css' %}"></head>
    <div class = "main_message">
        <div class = "border_needed left-side">

            <div class = "msg_main"><span class = "text">쪽지함</span></div>

            <div class = "message_lists">
            <!-- 페이지 좌측에 현재 대화중인 목록 나타내는 부분-->
            {% for lastmessage in lastmessages %}
                {% if lastmessage.user_to.id == id %}
                    <a  href="{% url 'chatroom' chat_from lastmessage.user_from.id %}">
                        <div  class = "message">
                            <div>
                            <div class = "nickname">{{ lastmessage.user_from.profile.nickname }}</div><div class = "contents">{{ lastmessage.content }}</div></div>
                            <div class = "dates">{{ lastmessage.created_at|date:"y.m.d" }}</div>
                        </div>
                    </a>
                {% else %}
                    <a  href="{% url 'chatroom' chat_from lastmessage.user_to.id %}">
                        <div  class = "message">
                            <div>
                            <div class = "nickname">{{ lastmessage.user_to.profile.nickname }}</div><div class = "contents">{{ lastmessage.content }}</div></div>
                            <div class = "dates">{{ lastmessage.created_at|date:"y.m.d" }}</div>
                        </div>
                    </a>
                {% endif %}
            {% endfor %}
            </div>
        </div>
    
        <div class = "border_needed right-side">
            
            <div class = "sender_id">
                <div class = 'freindname'>{{ friend }}</div>
                <div><button>삭제</button></div>
            </div>

            <div class = "chatroom">
                {% for message in messages|dictsort:'created_at' %}
                    {% if message.user_from.id == chat_from %}
                        <div class = "send"><div class = "chat_date">{{ message.created_at}}</div><div class = "chat_con">{{ message.content }}</div></div>
                    {% else %}
                        <div class = "recieve"><div class = "chat_con">{{ message.content }}</div><div class = "chat_date">{{ message.created_at}}</div></div>
                    {% endif %}
                {% endfor %}
            </div>
            <div class = "sending">
                <form action="{% url 'sendmessage' chat_from chat_to  %} "method="POST">
                {% csrf_token %}
                <div class = "typing" >
                <div><input class="sendbox"  type="text" name="content" /></div>
                <button type="submit">메시지 보내기</button>
                </div>
                </form>
            </div>


        </div>
        
    
    </div>



{% endblock content %}
